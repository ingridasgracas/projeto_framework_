<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invent√°rio do Data Lake - RJ SuperApp</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1 { color: #1976d2; border-bottom: 3px solid #1976d2; padding-bottom: 10px; }
        h2 { color: #1976d2; border-bottom: 2px solid #e3f2fd; padding-bottom: 5px; }
        h3 { color: #424242; }
        h4 { color: #616161; }
        
        .toc {
            background: #f5f5f5;
            border-left: 4px solid #1976d2;
            padding: 15px;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border: 1px solid #ddd;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px 8px;
            text-align: left;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .highlight {
            background-color: #fff3e0;
            padding: 10px;
            border-left: 4px solid #ff9800;
            margin: 10px 0;
        }
        
        .info-box {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .warning-box {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        
        code {
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #ddd;
        }
        
        .emoji {
            font-size: 1.2em;
        }
        
        .diagram-note {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            border: 1px solid #4caf50;
        }
    </style>
</head>
<body>

<h1>üìä Invent√°rio do Data Lake - RJ SuperApp</h1>

<div class="info-box">
    <h2>üìã Vis√£o Geral</h2>
    <p>Este documento descreve o invent√°rio completo das tabelas e campos dispon√≠veis no data lake do RJ SuperApp, organizados em dois datasets principais: <strong>brutos_rmi</strong> (sistema principal) e <strong>brutos_go</strong> (plataforma educacional).</p>
    <p><strong>Data da An√°lise:</strong> 18 de setembro de 2025</p>
</div>

<div class="toc">
    <h3>üìë √çndice</h3>
    <ul>
        <li><a href="#fluxograma">üèóÔ∏è Fluxograma da Arquitetura</a></li>
        <li><a href="#erd">üîó Diagrama de Entidade-Relacionamento</a></li>
        <li><a href="#arquitetura">üèóÔ∏è Arquitetura dos Datasets</a></li>
        <li><a href="#inventario">üìä Invent√°rio Detalhado de Tabelas</a></li>
        <li><a href="#relacionamentos">üîó Relacionamentos Entre Tabelas</a></li>
        <li><a href="#tracking">üìà Eventos de Tracking Identificados</a></li>
        <li><a href="#casos-uso">üéØ Casos de Uso de Tracking</a></li>
        <li><a href="#consideracoes">‚ö†Ô∏è Considera√ß√µes T√©cnicas</a></li>
        <li><a href="#proximos-passos">üìã Pr√≥ximos Passos</a></li>
    </ul>
</div>

<div class="diagram-note">
    <h3>üìä Nota sobre Diagramas</h3>
    <p>Os diagramas Mermaid inclu√≠dos neste documento podem n√£o ser renderizados corretamente no Google Docs. Para visualiza√ß√£o completa dos fluxogramas e ERD, consulte os arquivos .mmd originais ou acesse uma ferramenta de visualiza√ß√£o Mermaid online.</p>
</div>

<h2 id="arquitetura">üèóÔ∏è Arquitetura dos Datasets</h2>

<h3>Dataset: <code>rj-superapp.brutos_rmi</code></h3>
<div class="info-box">
    <p><strong>Descri√ß√£o:</strong> Sistema principal de gest√£o de usu√°rios e intera√ß√µes</p>
    <p><strong>Tabelas:</strong> 7 tabelas</p>
    <p><strong>Funcionalidade:</strong> Tracking de usu√°rios, auditoria, comunica√ß√£o, perfis</p>
</div>

<h3>Dataset: <code>rj-superapp.brutos_go</code></h3>
<div class="info-box">
    <p><strong>Descri√ß√£o:</strong> Plataforma educacional e de cursos</p>
    <p><strong>Tabelas:</strong> 2 tabelas</p>
    <p><strong>Funcionalidade:</strong> Gest√£o de cursos e inscri√ß√µes</p>
</div>

<h2 id="inventario">üìä Invent√°rio Detalhado de Tabelas</h2>

<h3>üîß brutos_rmi - Sistema Principal</h3>

<h4>1. <code>rmi_audit_logs</code> - Logs de Auditoria</h4>
<div class="highlight">
    <strong>Prop√≥sito:</strong> Rastreamento de todas as a√ß√µes e modifica√ß√µes no sistema
</div>

<table>
    <thead>
        <tr>
            <th>Campo</th>
            <th>Tipo</th>
            <th>Nullable</th>
            <th>Descri√ß√£o</th>
        </tr>
    </thead>
    <tbody>
        <tr><td colspan="4"><strong>Campos Airbyte</strong></td></tr>
        <tr><td><code>_airbyte_raw_id</code></td><td>STRING</td><td>NO</td><td>ID √∫nico do registro Airbyte</td></tr>
        <tr><td><code>_airbyte_extracted_at</code></td><td>TIMESTAMP</td><td>NO</td><td>Timestamp de extra√ß√£o</td></tr>
        <tr><td><code>_airbyte_meta</code></td><td>JSON</td><td>NO</td><td>Metadados Airbyte</td></tr>
        <tr><td><code>_airbyte_generation_id</code></td><td>INT64</td><td>YES</td><td>ID da gera√ß√£o Airbyte</td></tr>
        <tr><td colspan="4"><strong>Identificadores</strong></td></tr>
        <tr><td><code>_id</code></td><td>STRING</td><td>YES</td><td>ID interno do registro</td></tr>
        <tr><td><code>cpf</code></td><td>STRING</td><td>YES</td><td>üîë CPF do usu√°rio</td></tr>
        <tr><td colspan="4"><strong>Dados de Auditoria</strong></td></tr>
        <tr><td><code>action</code></td><td>STRING</td><td>YES</td><td>üìù Tipo de a√ß√£o realizada</td></tr>
        <tr><td><code>resource</code></td><td>STRING</td><td>YES</td><td>üìÇ Recurso afetado</td></tr>
        <tr><td><code>old_value</code></td><td>STRING</td><td>YES</td><td>Valor anterior</td></tr>
        <tr><td><code>new_value</code></td><td>STRING</td><td>YES</td><td>Valor novo</td></tr>
        <tr><td><code>timestamp</code></td><td>STRING</td><td>YES</td><td>‚è∞ Timestamp da a√ß√£o</td></tr>
        <tr><td><code>ip_address</code></td><td>STRING</td><td>YES</td><td>IP do usu√°rio</td></tr>
        <tr><td><code>user_agent</code></td><td>STRING</td><td>YES</td><td>User agent do navegador</td></tr>
        <tr><td><code>request_id</code></td><td>STRING</td><td>YES</td><td>ID da requisi√ß√£o</td></tr>
    </tbody>
</table>

<div class="highlight">
    <h4>Eventos Rastreados:</h4>
    <ul>
        <li>Modifica√ß√µes de dados pessoais</li>
        <li>Altera√ß√µes de endere√ßo</li>
        <li>Mudan√ßas de telefone/email</li>
        <li>Atualiza√ß√µes de status</li>
    </ul>
</div>

<h4>2. <code>rmi_avatars</code> - Perfis de Usu√°rios</h4>
<div class="highlight">
    <strong>Prop√≥sito:</strong> Gest√£o de perfis e avatares dos usu√°rios
</div>

<table>
    <thead>
        <tr>
            <th>Categoria</th>
            <th>Campos</th>
        </tr>
    </thead>
    <tbody>
        <tr><td><strong>Identifica√ß√£o</strong></td><td><code>_id</code>, <code>cpf</code>, <code>name</code>, <code>nome</code></td></tr>
        <tr><td><strong>Dados Pessoais</strong></td><td><code>raca</code>, <code>sexo</code>, <code>mae_nome</code>, <code>nascimento_*</code></td></tr>
        <tr><td><strong>Endere√ßo</strong></td><td><code>endereco_principal_*</code>, <code>endereco_alternativo</code></td></tr>
        <tr><td><strong>Contato</strong></td><td><code>email_principal_*</code>, <code>telefone_principal_*</code></td></tr>
        <tr><td><strong>Sa√∫de</strong></td><td><code>saude_clinica_familia_*</code>, <code>saude_equipe_*</code></td></tr>
        <tr><td><strong>Assist√™ncia Social</strong></td><td><code>assistencia_social_*</code>, <code>bolsa_familia_*</code></td></tr>
        <tr><td><strong>Auditoria</strong></td><td><code>created_at</code>, <code>updated_at</code>, <code>datalake_last_updated</code></td></tr>
    </tbody>
</table>

<h4>3. <code>rmi_beta_groups</code> - Grupos Beta</h4>
<div class="highlight">
    <strong>Prop√≥sito:</strong> Gest√£o de usu√°rios em grupos de teste
</div>

<table>
    <thead>
        <tr>
            <th>Campo</th>
            <th>Tipo</th>
            <th>Descri√ß√£o</th>
        </tr>
    </thead>
    <tbody>
        <tr><td><code>cpf</code></td><td>STRING</td><td>üîë CPF do usu√°rio</td></tr>
        <tr><td><code>status</code></td><td>STRING</td><td>Status no grupo beta</td></tr>
        <tr><td><code>phone_number</code></td><td>STRING</td><td>Telefone de contato</td></tr>
        <tr><td><code>beta_group_id</code></td><td>STRING</td><td>üéØ ID do grupo beta</td></tr>
        <tr><td><code>created_at</code></td><td>STRING</td><td>‚è∞ Data de entrada</td></tr>
        <tr><td><code>updated_at</code></td><td>STRING</td><td>‚è∞ √öltima atualiza√ß√£o</td></tr>
    </tbody>
</table>

<h4>4. <code>rmi_opt_in_history</code> - Hist√≥rico de Consentimento</h4>
<div class="highlight">
    <strong>Prop√≥sito:</strong> Rastreamento de opt-in/opt-out de comunica√ß√µes
</div>

<table>
    <thead>
        <tr>
            <th>Campo</th>
            <th>Tipo</th>
            <th>Descri√ß√£o</th>
        </tr>
    </thead>
    <tbody>
        <tr><td><code>cpf</code></td><td>STRING</td><td>üîë CPF do usu√°rio</td></tr>
        <tr><td><code>action</code></td><td>STRING</td><td>üì± A√ß√£o (opt-in/opt-out)</td></tr>
        <tr><td><code>channel</code></td><td>STRING</td><td>üì¢ Canal de comunica√ß√£o</td></tr>
        <tr><td><code>reason</code></td><td>STRING</td><td>Motivo da a√ß√£o</td></tr>
        <tr><td><code>phone_number</code></td><td>STRING</td><td>N√∫mero de telefone</td></tr>
        <tr><td><code>timestamp</code></td><td>STRING</td><td>‚è∞ Timestamp da a√ß√£o</td></tr>
    </tbody>
</table>

<div class="highlight">
    <h4>Canais Rastreados:</h4>
    <ul>
        <li>SMS</li>
        <li>WhatsApp</li>
        <li>Email</li>
        <li>Push notifications</li>
    </ul>
</div>

<h3>üéì brutos_go - Plataforma Educacional</h3>

<h4>1. <code>inscricoes</code> - Inscri√ß√µes em Cursos</h4>
<div class="highlight">
    <strong>Prop√≥sito:</strong> Gest√£o de inscri√ß√µes e jornada educacional
</div>

<table>
    <thead>
        <tr>
            <th>Campo</th>
            <th>Tipo</th>
            <th>Nullable</th>
            <th>Descri√ß√£o</th>
        </tr>
    </thead>
    <tbody>
        <tr><td colspan="4"><strong>Identificadores</strong></td></tr>
        <tr><td><code>id</code></td><td>STRING</td><td>YES</td><td>üîë ID da inscri√ß√£o</td></tr>
        <tr><td><code>cpf</code></td><td>STRING</td><td>YES</td><td>üîë CPF do usu√°rio</td></tr>
        <tr><td><code>curso_id</code></td><td>INT64</td><td>YES</td><td>üîó ID do curso</td></tr>
        <tr><td colspan="4"><strong>Status da Inscri√ß√£o</strong></td></tr>
        <tr><td><code>status</code></td><td>STRING</td><td>YES</td><td>üìä Status atual</td></tr>
        <tr><td><code>reason</code></td><td>STRING</td><td>YES</td><td>Motivo/observa√ß√µes</td></tr>
        <tr><td colspan="4"><strong>Timeline Educacional</strong></td></tr>
        <tr><td><code>enrolled_at</code></td><td>TIMESTAMP</td><td>YES</td><td>‚è∞ Data de inscri√ß√£o</td></tr>
        <tr><td><code>concluded_at</code></td><td>TIMESTAMP</td><td>YES</td><td>‚è∞ Data de conclus√£o</td></tr>
        <tr><td><code>updated_at</code></td><td>TIMESTAMP</td><td>YES</td><td>‚è∞ √öltima atualiza√ß√£o</td></tr>
        <tr><td colspan="4"><strong>Certifica√ß√£o</strong></td></tr>
        <tr><td><code>certificate_url</code></td><td>STRING</td><td>YES</td><td>üèÜ URL do certificado</td></tr>
    </tbody>
</table>

<div class="highlight">
    <h4>Status Poss√≠veis:</h4>
    <ul>
        <li>Inscrito</li>
        <li>Em andamento</li>
        <li>Conclu√≠do</li>
        <li>Cancelado</li>
        <li>Suspenso</li>
    </ul>
</div>

<h4>2. <code>cursos</code> - Cat√°logo de Cursos</h4>
<div class="highlight">
    <strong>Prop√≥sito:</strong> Informa√ß√µes detalhadas sobre os cursos oferecidos
</div>

<table>
    <thead>
        <tr>
            <th>Campo</th>
            <th>Tipo</th>
            <th>Nullable</th>
            <th>Descri√ß√£o</th>
        </tr>
    </thead>
    <tbody>
        <tr><td colspan="4"><strong>Identifica√ß√£o</strong></td></tr>
        <tr><td><code>id</code></td><td>INT64</td><td>YES</td><td>üîë ID √∫nico do curso</td></tr>
        <tr><td><code>titulo</code></td><td>STRING</td><td>YES</td><td>üìö T√≠tulo do curso</td></tr>
        <tr><td><code>theme</code></td><td>STRING</td><td>YES</td><td>Tema/categoria</td></tr>
        <tr><td colspan="4"><strong>Configura√ß√£o Acad√™mica</strong></td></tr>
        <tr><td><code>modalidade</code></td><td>STRING</td><td>YES</td><td>üéØ Modalidade (presencial/online)</td></tr>
        <tr><td><code>carga_horaria</code></td><td>INT64</td><td>YES</td><td>‚è±Ô∏è Carga hor√°ria total</td></tr>
        <tr><td><code>numero_vagas</code></td><td>INT64</td><td>YES</td><td>üë• N√∫mero de vagas</td></tr>
        <tr><td colspan="4"><strong>Cronograma</strong></td></tr>
        <tr><td><code>data_inicio</code></td><td>DATETIME</td><td>YES</td><td>‚è∞ Data de in√≠cio</td></tr>
        <tr><td><code>data_termino</code></td><td>DATETIME</td><td>YES</td><td>‚è∞ Data de t√©rmino</td></tr>
        <tr><td><code>enrollment_start_date</code></td><td>TIMESTAMP</td><td>YES</td><td>üìù In√≠cio das inscri√ß√µes</td></tr>
        <tr><td><code>enrollment_end_date</code></td><td>TIMESTAMP</td><td>YES</td><td>üìù Fim das inscri√ß√µes</td></tr>
    </tbody>
</table>

<h2 id="relacionamentos">üîó Relacionamentos Entre Tabelas</h2>

<h3>Chaves Prim√°rias de Liga√ß√£o</h3>

<table>
    <thead>
        <tr>
            <th>Chave</th>
            <th>Presente em</th>
            <th>Fun√ß√£o</th>
        </tr>
    </thead>
    <tbody>
        <tr><td><strong>CPF</strong></td><td>Todas as tabelas RMI + <code>inscricoes</code></td><td>Identificador universal de usu√°rio - Permite tracking cross-platform</td></tr>
        <tr><td><strong>curso_id</strong></td><td><code>inscricoes.curso_id</code> ‚Üí <code>cursos.id</code></td><td>Relacionamento 1:N (um curso, v√°rias inscri√ß√µes)</td></tr>
        <tr><td><strong>phone_number</strong></td><td><code>rmi_opt_in_history</code>, <code>rmi_beta_groups</code>, <code>rmi_phone_cpf_mappings</code></td><td>Identificador secund√°rio</td></tr>
    </tbody>
</table>

<h3>Campos Temporais por Contexto</h3>

<table>
    <thead>
        <tr>
            <th>Contexto</th>
            <th>Campos</th>
            <th>Formato</th>
        </tr>
    </thead>
    <tbody>
        <tr><td><strong>Auditoria</strong></td><td><code>timestamp</code>, <code>created_at</code>, <code>updated_at</code></td><td>STRING</td></tr>
        <tr><td><strong>Educacional</strong></td><td><code>enrolled_at</code>, <code>concluded_at</code>, <code>data_inicio</code></td><td>TIMESTAMP/DATETIME</td></tr>
        <tr><td><strong>Sistema</strong></td><td><code>_airbyte_extracted_at</code>, <code>datalake_last_updated</code></td><td>TIMESTAMP/STRING</td></tr>
    </tbody>
</table>

<h2 id="tracking">üìà Eventos de Tracking Identificados</h2>

<h3>üîç RMI - Sistema Principal</h3>

<table>
    <thead>
        <tr>
            <th>Tabela</th>
            <th>Eventos</th>
            <th>Campos Chave</th>
        </tr>
    </thead>
    <tbody>
        <tr><td><code>rmi_audit_logs</code></td><td>Modifica√ß√µes de dados</td><td><code>action</code>, <code>resource</code>, <code>timestamp</code></td></tr>
        <tr><td><code>rmi_opt_in_history</code></td><td>Consentimento comunica√ß√£o</td><td><code>action</code>, <code>channel</code>, <code>reason</code></td></tr>
        <tr><td><code>rmi_beta_groups</code></td><td>Participa√ß√£o em testes</td><td><code>status</code>, <code>beta_group_id</code></td></tr>
        <tr><td><code>rmi_avatars</code></td><td>Cria√ß√£o/atualiza√ß√£o perfil</td><td><code>created_at</code>, <code>updated_at</code></td></tr>
    </tbody>
</table>

<h3>üéì GO - Plataforma Educacional</h3>

<table>
    <thead>
        <tr>
            <th>Tabela</th>
            <th>Eventos</th>
            <th>Campos Chave</th>
        </tr>
    </thead>
    <tbody>
        <tr><td><code>inscricoes</code></td><td>Jornada educacional</td><td><code>enrolled_at</code>, <code>concluded_at</code>, <code>status</code></td></tr>
        <tr><td><code>cursos</code></td><td>Gest√£o de ofertas</td><td><code>enrollment_start_date</code>, <code>enrollment_end_date</code></td></tr>
    </tbody>
</table>

<h2 id="casos-uso">üéØ Casos de Uso de Tracking</h2>

<h3>1. Jornada do Usu√°rio Cross-Platform</h3>
<div class="highlight">
    <p>Exemplo: Usu√°rios que se inscreveram em cursos ap√≥s a√ß√µes no RMI</p>
    <pre><code>SELECT r.cpf, r.action, r.timestamp, g.enrolled_at, c.titulo
FROM rmi_audit_logs r
JOIN inscricoes g ON r.cpf = g.cpf
JOIN cursos c ON g.curso_id = c.id
WHERE r.timestamp < g.enrolled_at</code></pre>
</div>

<h3>2. An√°lise de Engajamento</h3>
<ul>
    <li>Taxa de opt-out por canal</li>
    <li>Convers√£o de inscri√ß√£o para conclus√£o</li>
    <li>Atividade por hor√°rio/dia da semana</li>
</ul>

<h3>3. Segmenta√ß√£o de Usu√°rios</h3>
<ul>
    <li>Usu√°rios beta vs. regulares</li>
    <li>Multi-platform vs. single-platform</li>
    <li>Engajamento educacional por perfil demogr√°fico</li>
</ul>

<h3>4. An√°lise de Comunica√ß√£o</h3>
<ul>
    <li>Efetividade de canais por p√∫blico</li>
    <li>Padr√µes de opt-in/opt-out</li>
    <li>Resposta a campanhas</li>
</ul>

<h2 id="consideracoes">‚ö†Ô∏è Considera√ß√µes T√©cnicas</h2>

<div class="warning-box">
    <h3>Formato de Dados</h3>
    <ul>
        <li><strong>RMI:</strong> Timestamps em formato STRING (requer parsing)</li>
        <li><strong>GO:</strong> Timestamps estruturados (TIMESTAMP/DATETIME)</li>
        <li><strong>JSON:</strong> Campos aninhados requerem parsing espec√≠fico</li>
    </ul>
</div>

<div class="warning-box">
    <h3>Qualidade dos Dados</h3>
    <ul>
        <li><strong>Campos nullable:</strong> Verificar completude antes da an√°lise</li>
        <li><strong>CPF:</strong> Campo chave para liga√ß√£o entre sistemas</li>
        <li><strong>Timestamps:</strong> Validar consist√™ncia temporal</li>
    </ul>
</div>

<div class="warning-box">
    <h3>Performance</h3>
    <ul>
        <li><strong>√çndices recomendados:</strong> <code>cpf</code>, <code>timestamp</code>, <code>curso_id</code></li>
        <li><strong>Particionamento:</strong> Por data para tabelas de log</li>
        <li><strong>Materializa√ß√£o:</strong> Considerar views para consultas frequentes</li>
    </ul>
</div>

<h2 id="proximos-passos">üìã Pr√≥ximos Passos</h2>

<h3>1. Valida√ß√£o de Dados</h3>
<ul>
    <li>Verificar completude dos CPFs</li>
    <li>Validar consist√™ncia temporal</li>
    <li>Identificar poss√≠veis duplicatas</li>
</ul>

<h3>2. Modelagem Analytics</h3>
<ul>
    <li>Criar tabelas fato/dimens√£o</li>
    <li>Implementar SCD para tracking hist√≥rico</li>
    <li>Desenvolver m√©tricas de neg√≥cio</li>
</ul>

<h3>3. Dashboards e Monitoramento</h3>
<ul>
    <li>KPIs de engajamento</li>
    <li>Funnel de convers√£o educacional</li>
    <li>Alertas de qualidade de dados</li>
</ul>

<hr>

<div class="info-box">
    <p><strong>Documento gerado em:</strong> 18 de setembro de 2025</p>
    <p><strong>Vers√£o:</strong> 1.0</p>
    <p><strong>√öltima atualiza√ß√£o:</strong> An√°lise inicial do esquema</p>
</div>

</body>
</html>